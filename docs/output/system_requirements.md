# システム要件定義書

## システム概要
本システム「CrossBar」は、経営者および企業の従業員を対象とした、位置情報活用型のナイトタイム・ビジネスマッチングプラットフォームである。「テキスト入力ゼロ（Zero-Text）」のUXをコアとし、AIによるマッチング推奨（Smart Spotlight）と動的な位置情報制御（Visibility Matrix）を組み合わせることで、誘う側の心理的負担を極限まで下げつつ、質の高い対面交流（社外交流・社内メンタリング）を創出する。法人向けには、組織の活性化度を可視化する分析機能を提供し、エンゲージメント向上と離職防止に寄与する。

1. システムの目的
   - 会食後（21:00〜）の空き時間を、有意義なビジネス接点に変える。
   - 組織の「縦割り（サイロ化）」を解消し、偶発的なコミュニケーションを促進する。
   - 誘う・調整するという「言語化コスト」による機会損失を排除する。

2. 主な機能
   - **コア機能**: Smart Spotlight（AI推奨マッチング）、Magic Toggle（4段階ステータス）、One-Tap Offer（乾杯・おごり・相談シグナル）。
   - **差別化機能**: Visibility Matrix（関係性に応じた動的曖昧化ロジック）、Boss Block（特定個人への隠蔽）。
   - **付加価値機能**: 提携店舗へのワンタップ予約、法人向け組織活性化分析レポート。

3. 提供する価値
   - **ユーザー**: 「今、誰と会えるか」が直感的にわかり、拒絶の不安なくスマートに誘える体験。
   - **ビジネス**: 従業員同士の「タテ・ヨコ」の繋がり強化による離職率低下とイノベーション加速。

4. 実現方法の概要
   - **モバイルファースト**: 高頻度の位置情報更新とプッシュ通知を軸としたリアルタイム設計。
   - **AI/ML連携**: ユーザー属性、タグ、過去のマッチング履歴に基づき、マップ上のピンを強調（Spotlight）する。
   - **セキュリティ**: 緯度経度データの厳重な秘匿化と、関係性に基づく動的フィルタリングAPIの実装。

## 情報の前提と仮定
- 分析情報源: `docs/input/` 内の README, business-requirements, product-requirements 等。
- 仮定: 初期ユーザーは特定のスタートアップ界隈・経営者コミュニティ約1,000人を想定。位置情報の更新間隔はアクティブ時5秒〜10秒程度。

## 機能要件
- **認証・認可**: 企業ドメインによる自動所属判定、Clerkを用いたセキュアな認証。
- **位置情報エンジン**: ユーザーのステータスが「Ghost」以外の場合、位置情報を定期取得。相手との関係性（自社/他社/役職）に基づき、フロントエンドへの座標返却時に曖昧化処理を適用。
- **マッチングロジック**: 
  - `Smart Spotlight`: 共通タグ、過去の交流、AIレコメンドにより、マップ上の特定のピンに視覚的エフェクトを付与。
  - `One-Tap Offer`: 物理的なカードスワイプのような操作でオファーを送信。
- **通知システム**: 相互承諾（Match）時のプッシュ通知、および「近くに相性の良い人が現れた」際の近接通知。
- **法人管理画面**: 人事担当者向け。個人を特定しない形での「部署間交流ヒートマップ」やKPI計測。

## 非機能要件
- **パフォーマンス**: 位置情報の更新からマップ反映まで5秒以内。主要なボタン操作（Offer等）のレスポンスは1秒以内。
- **セキュリティ**: 位置情報はDB上で暗号化保存し、一定期間経過後に自動削除。
- **スケーラビリティ**: 同時接続数10,000ユーザーを初期上限とし、地理的なパーティショニング（リージョン分割）を考慮した設計。
- **可用性**: 夜間（21:00 - 26:00）をピークタイムとし、99.9%の稼働率を目指す。

## 技術スタック
- **フロントエンド**: **Next.js (React / PWA)** または **React Native (Expo)** 
  - *選定理由*: 位置情報の高頻度取得とOS標準の通知機能を利用するため、ネイティブアプリ化（または高度なPWA）が必須。開発効率を優先しReact Nativeを推奨。
- **言語**: **TypeScript** (型安全性と保守性のため)
- **バックエンド**: **Next.js App Router (Vercel) / Node.js**
- **データベース・BaaS**: **Supabase (PostgreSQL / PostGIS)**
  - *選定理由*: 地理空間情報（PostGIS）の扱いに長けており、リアルタイム機能（Realtime）が標準搭載されているため。
- **認証**: **Clerk**
- **AI**: **OpenAI API (GPT-4o)**
  - *選定理由*: ユーザー属性やタグ、状況からのマッチング理由生成（Spotlight用）に利用。
- **地図基盤**: **Mapbox**
  - *選定理由*: カスタムスタイル（Dark & Neon）が容易で、モバイルでの描画パフォーマンスがGoogle Mapsより優れるケースが多いため。

## 開発ロードマップ
- **Phase 1: MVP (2ヶ月)**:
  - 基本マップ表示、Visibility Matrix（曖昧化）の基礎、3つのステータスボタン。
  - 理由: コアUXである「曖昧な位置情報でのマッチング」の技術検証を最優先。
- **Phase 2: Engagement (2ヶ月)**:
  - Smart Spotlight（AI推奨）、Boss Block、提携店予約連携。
  - 理由: リピート率とビジネスモデル（送客）の検証。
- **Phase 3: Enterprise (3ヶ月)**:
  - 法人管理画面、分析レポート、経費精算API連携。
  - 理由: 法人契約（メイン収益）の獲得に向けた機能拡充。

## リスク分析
- **技術的リスク**: バックグラウンドでの位置情報取得によるバッテリー消費。 -> 対策: アクティブ時のみ高頻度化する省電力アルゴリズムの実装。
- **ビジネス的リスク**: 「監視されている」という心理的不安。 -> 対策: 「曖昧表示」を標準とし、ユーザーがいつでもオフにできることを徹底強調。
- **法的リスク**: ストーカー被害等のトラブル。 -> 対策: 法人ドメイン限定、通報機能、およびVisibility Matrixによる詳細位置の秘匿。

## UI/UXの方向性
- **デザインコンセプト**: **Night-Life Neon** (夜の街に溶け込む、没入感のあるデザイン)
- **トーン＆マナー**: ダークモード基調（黒・紺）、アクセントにネオンカラー（緑・ピンク・紫）。
- **ターゲットデバイス**: モバイル（iOS/Android）が100%。片手操作（親指のみ）を前提としたカード・トグル配置。
- **参考アプリ**:
  - **Zenly**: 位置情報の見せ方とUIの心地よさ。
  - **Tinder/Bumble**: スワイプによる直感的な意思表示。
  - **Linear**: ダークモードの洗練された配色とタイポグラフィ。

## 追加情報リクエスト
1. **重要度・高**: 既存の提携店候補や、予約連携を想定しているAPI（テーブルチェック等）の有無。
2. **重要度・中**: 法人レポートで人事が「最も知りたい」具体的な数値（離職兆候、特定の部署の孤立など）。
3. **重要度・低**: 初期テストを行うコミュニティの具体的な規模と、使用するデバイス（iPhoneメインか等）。

